<template>
  <div class="documents nf-notes">
    <!-- <breadcrumb /> -->
    <div v-if="error" class="error">
      {{ error }}
    </div>
    <div v-if="loading" class="loading">
      Chargement...
    </div>
    <section v-else class="netframe-list-wrapper" >
      <!-- <h6 class="documents-section-title">{{ $t('myNotes') }}</h6> -->
      <ul class="list-unstyled netframe-list">
        <li v-for="doc in docs" class="item" v-bind:data-date="doc.last_update" :key="doc.id">
          <router-link
            :to="{ path: '/collab/' + doc.id }"
            class="item-link"
          ></router-link>
          <div class="item-icon">
            <span class="svgicon">
              <svg width="30px" height="30px" viewBox="0 0 30 30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <path class="back" d="M16.9451376,4 C19.1668762,4.02357714 20.4817032,4.28612734 21.8552003,5.02068164 C23.1928206,5.73604876 24.2605302,6.8037584 24.9758973,8.14137863 C25.6696431,9.43857035 25.9423728,10.6834298 25.9903749,12.6985859 L25.996553,13.0623653 L25.9982895,13.4080025 L25.9982895,16.5885765 C25.9982895,19.0458383 25.7464618,20.41437 24.9758973,21.8552003 C24.2605302,23.1928206 23.1928206,24.2605302 21.8552003,24.9758973 C20.5580086,25.6696431 19.3131492,25.9423728 17.2979931,25.9903749 L16.9342137,25.996553 L16.5885765,25.9982895 L13.4080025,25.9982895 C11.6240084,25.9982895 10.4138719,25.8655539 9.33330075,25.4979442 L7.73033714,25.8979063 C5.58812431,26.4334595 3.6426557,24.554935 4.05583146,22.4242331 L4.09230282,22.259872 L4.49476247,20.650225 C4.18055629,19.7195134 4.03945082,18.6913527 4.00618219,17.2894016 L4,16.9240151 L4,13.0514414 C4.02357714,10.8297028 4.28612734,9.51487575 5.02068164,8.14137863 C5.73604876,6.8037584 6.8037584,5.73604876 8.14137863,5.02068164 C9.43857035,4.32693591 10.6834298,4.05420619 12.7071774,4.00618219 L13.0725639,4 L16.9451376,4 Z" fill="#FFFFFF" fill-rule="nonzero"></path>
                  <path class="front" d="M16.9240151,6 C18.8821944,6.02068193 19.8787202,6.23170254 20.9120026,6.78430803 C21.9010859,7.31327556 22.6833034,8.09549306 23.2122709,9.08457635 C23.7648764,10.1178588 23.975897,11.1143846 23.996579,13.0725639 L23.9982895,13.4080025 L23.9982895,16.5885765 C23.9982895,18.7715828 23.7955767,19.8213156 23.2122709,20.9120026 C22.6833034,21.9010859 21.9010859,22.6833034 20.9120026,23.2122709 C19.8787202,23.7648764 18.8821944,23.975897 16.9240151,23.996579 L16.5885765,23.9982895 L13.235,23.997 L15.234,21.998 L16.5885765,21.9982895 L17.1459586,21.9934108 L17.3986989,21.9871521 L17.8573815,21.9664614 C18.859607,21.9049704 19.4078221,21.7486614 19.9688049,21.4486445 C20.6093512,21.1060766 21.1060766,20.6093512 21.4486445,19.9688049 C21.7453645,19.4139867 21.9015176,18.8716572 21.9643998,17.8902581 L21.9782046,17.6354997 L21.9934108,17.1459586 L21.9982895,16.5885765 L21.9982895,13.4080025 L21.9934108,12.8506204 L21.9871521,12.5978801 L21.9664614,12.1391975 C21.9049704,11.136972 21.7486614,10.5887569 21.4486445,10.0277741 C21.1060766,9.38722773 20.6093512,8.89050236 19.9688049,8.54793443 C19.4139867,8.25121442 18.8716572,8.09506132 17.8902581,8.03217914 L17.6354997,8.01837436 L17.1459586,8.00316816 L16.7824124,7.99882099 L13.120321,7.99949132 L12.7645396,8.00496224 L12.5978801,8.00942687 L12.1391975,8.03011754 C11.136972,8.09160861 10.5887569,8.24791754 10.0277741,8.54793443 C9.38722773,8.89050236 8.89050236,9.38722773 8.54793443,10.0277741 C8.25121442,10.5825923 8.09506132,11.1249218 8.03217914,12.1063209 L8.01837436,12.3610793 L8.00316816,12.8506204 L7.99828947,13.4080025 L7.998,14.75 L5.999,16.749 L6,13.0725639 C6.02068193,11.1143846 6.23170254,10.1178588 6.78430803,9.08457635 C7.31327556,8.09549306 8.09549306,7.31327556 9.08457635,6.78430803 C10.1178588,6.23170254 11.1143846,6.02068193 13.0725639,6 L16.9240151,6 Z M15.8105875,11.9725149 C16.8877303,12.2611345 17.7290747,13.1024788 18.0176942,14.1796217 C18.3063138,15.2567645 17.9983604,16.4060623 17.2098371,17.1945856 L11.7098371,22.6945856 C11.5816783,22.8227444 11.4210984,22.9136632 11.2452659,22.9576213 L7.24526592,23.9576213 C6.51288548,24.1407164 5.8494927,23.4773236 6.03258782,22.7449432 L7.03258782,18.7449432 C7.07654592,18.5691107 7.16746472,18.4085308 7.29562352,18.280372 L12.7956235,12.7803721 C13.5841468,11.9918487 14.7334446,11.6838953 15.8105875,11.9725149 Z M14.2098371,14.1945856 L8.90573032,19.4981101 L8.37673032,21.6131101 L10.4907303,21.0841101 L15.7956235,15.780372 C16.0474222,15.5285734 16.1628118,15.1743695 16.1125239,14.8269927 L16.0858426,14.6972597 C15.9821573,14.310301 15.6799081,14.0080518 15.2929494,13.9043665 C14.9059906,13.8006812 14.4931105,13.9113121 14.2098371,14.1945856 Z" fill="#000000" fill-rule="nonzero"></path>
              </svg>
            </span>
          </div>
          <div class="document-infos">
            <h4 class="document-title">{{ doc.name }}</h4>
            <p class="document-date">{{ doc.last_update_txt }}</p>
          </div>
          <ul class="nf-actions">
            <li class="nf-action">
              <a href="#" class="nf-btn btn-ico btn-submenu">
                <span class="svgicon btn-img">
                  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30">
                    <path class="back" fill="#FFF" fill-rule="nonzero" d="M22,11 C24.209139,11 26,12.790861 26,15 C26,17.209139 24.209139,19 22,19 C19.790861,19 18,17.209139 18,15 C18,12.790861 19.790861,11 22,11 Z M15,11 C17.209139,11 19,12.790861 19,15 C19,17.209139 17.209139,19 15,19 C12.790861,19 11,17.209139 11,15 C11,12.790861 12.790861,11 15,11 Z M8,11 C10.209139,11 12,12.790861 12,15 C12,17.209139 10.209139,19 8,19 C5.790861,19 4,17.209139 4,15 C4,12.790861 5.790861,11 8,11 Z"/>
                    <path class="front" fill="#333" fill-rule="nonzero" d="M22,13 C23.1045695,13 24,13.8954305 24,15 C24,16.0543618 23.1841222,16.9181651 22.1492623,16.9945143 L22.1492623,16.9945143 L22,17 L21.8507377,16.9945143 C20.8158778,16.9181651 20,16.0543618 20,15 C20,13.8954305 20.8954305,13 22,13 Z M15,13 C16.1045695,13 17,13.8954305 17,15 C17,16.0543618 16.1841222,16.9181651 15.1492623,16.9945143 L15.1492623,16.9945143 L15,17 L14.8507377,16.9945143 C13.8158778,16.9181651 13,16.0543618 13,15 C13,13.8954305 13.8954305,13 15,13 Z M8,13 C9.1045695,13 10,13.8954305 10,15 C10,16.0543618 9.18412221,16.9181651 8.14926234,16.9945143 L8.14926234,16.9945143 L8,17 L7.85073766,16.9945143 C6.81587779,16.9181651 6,16.0543618 6,15 C6,13.8954305 6.8954305,13 8,13 Z"/>
                  </svg>
                </span>
              </a>

              <div class="submenu-container submenu-right">
                <ul class="submenu">
                  <li>
                    <a
                      class="nf-btn"
                      v-bind:href="'/api/' + slug + '/edit/' + doc.id"
                      data-target="#modal-ajax"
                      data-toggle="modal"
                    >
                      <span class="btn-txt">
                        {{ $t('renameNote') }}
                      </span>
                    </a>
                  </li>
                  <li class="sep"></li>
                  <li>
                    <a href="#"
                      class="nf-btn delete-el"
                      v-bind:data-id="doc.id"
                    >
                      <span class="btn-txt">
                        {{ $t('deleteNote') }}
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
            </li>
          </ul>

        </li>
      </ul>
      <h6 class="documents-section-title">{{ $t('sharedWithMe') }}</h6>
      <ul class="list-unstyled netframe-list">
        <li v-for="doc in shared" class="item"  v-bind:data-date="doc.last_update" :key="doc.id">
          <router-link
            :to="{ path: '/collab/' + doc.id }"
            class="item-link"
          ></router-link>
          <div class="item-icon">
            <span class="svgicon">
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30">
                <g fill="none" fill-rule="evenodd">
                  <path fill="#FFF" class="back" fill-rule="nonzero" d="M6,20 L6,9 L6,9 C6,6.23857625 8.23857625,4 11,4 L16.7071204,4 L24,11.6112309 L24,20 C24,22.7614237 21.7614237,25 19,25 L11,25 C8.23857625,25 6,22.7614237 6,20 Z"/>
                  <path fill="#E00036" class="front" fill-rule="nonzero" d="M15.8535602,6 L22,12.4147463 L22,20 C22,21.6568542 20.6568542,23 19,23 L11,23 C9.34314575,23 8,21.6568542 8,20 L8,9 C8,7.34314575 9.34314575,6 11,6 L15.8535602,6 Z M14,8 L11,8 C10.4477153,8 10,8.44771525 10,9 L10,20 C10,20.5522847 10.4477153,21 11,21 L19,21 C19.5522847,21 20,20.5522847 20,20 L20,15 L17,15 C15.3431458,15 14,13.6568542 14,12 L14,8 Z M16,9.04365234 L16,12 C16,12.5522847 16.4477153,13 17,13 L19.7908674,13 L16,9.04365234 Z"/>
                </g>
              </svg>
            </span>
          </div>
          <div class="document-infos">
            <h4 class="document-title">{{ doc.name }}</h4>
            <p class="document-date">{{ doc.last_update_txt }}</p>
          </div>
        </li>
      </ul>
      <input type="hidden" id="order-input" @change="fetchData" />
    </section>
  </div>
</template>

<script>
import axios from "axios";
import Add from "./add.vue";
import Breadcrumb from "./breadcrumb.vue";
import Icon from "./btn-img.vue";
export default {
  components: {
    Add,
    Icon,
    Breadcrumb
  },
  data() {
    return {
      loading: false,
      docs: null,
      shared: null,
      error: null,
      slug: null,
    };
  },
  mounted() {
    // fetch the data when the view is created and the data is
    // already being observed
    this.fetchData();
  },
  watch: {
    // call again the method if the route changes
    '$route': 'fetchData',
  },
  methods: {
    fetchData() {
      this.error = this.docs = null;
      this.loading = true;
      this.slug = localStorage.getItem("apiToken");
      let order = this.$route.query.order_by;
      let route = "docs" + (order ? "?order_by="+order : '');
      // replace `getPost` with your data fetching util / API wrapper
      axios
        .get("/api/" + localStorage.getItem("apiToken") + "/" +route)
        .then((res) => {
          this.docs = res.data.docs;
          this.shared = res.data.shared;
        })
        .catch((e) => {
          this.error = e.toString();
        });
      this.loading = false;
    },
  },
};
</script>
